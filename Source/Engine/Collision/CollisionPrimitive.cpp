///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: May 9th, 2021
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Collision/CollisionPrimitive.h"
#include "Engine/Core/EngineCommon.h"
#include "Engine/Core/Entity.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
CollisionPrimitive::CollisionPrimitive(Entity* owningEntity)
	: entity(owningEntity)
{
}


//-------------------------------------------------------------------------------------------------
bool CollisionPrimitive::OwnerHasRigidBody() const
{
	return (entity->rigidBody != nullptr);
}


//-------------------------------------------------------------------------------------------------
RigidBody* CollisionPrimitive::GetOwnerRigidBody() const
{
	return entity->rigidBody;
}


//-------------------------------------------------------------------------------------------------
CollisionSphere::CollisionSphere(Entity* owningEntity, const Sphere3D& sphereLs)
	: TypedCollisionPrimitive(owningEntity, sphereLs)
{
}


//-------------------------------------------------------------------------------------------------
Sphere3D CollisionSphere::GetDataInWorldSpace() const
{
	Vector3 centerWs = entity->transform.TransformPosition(m_dataLs.center);
	return Sphere3D(centerWs, m_dataLs.radius);
}


//-------------------------------------------------------------------------------------------------
CollisionHalfSpace::CollisionHalfSpace(Entity* owningEntity, const Plane3& planeLs)
	: TypedCollisionPrimitive(owningEntity, planeLs)
{
}


//-------------------------------------------------------------------------------------------------
Plane3 CollisionHalfSpace::GetDataInWorldSpace() const
{
	Vector3 normalWs = entity->transform.TransformDirection(m_dataLs.m_normal);
	Vector3 positionLs = m_dataLs.m_normal * m_dataLs.m_distance;
	Vector3 positionWs = entity->transform.TransformPosition(positionLs);

	return Plane3(normalWs, positionWs);
}


//-------------------------------------------------------------------------------------------------
CollisionBox::CollisionBox(Entity* owningEntity, const OBB3& boxLs)
	: TypedCollisionPrimitive(owningEntity, boxLs)
{
}


//-------------------------------------------------------------------------------------------------
OBB3 CollisionBox::GetDataInWorldSpace() const
{
	Vector3 centerWs = entity->transform.TransformPosition(m_dataLs.center);
	Quaternion rotationWs = entity->transform.rotation * m_dataLs.rotation;

	return OBB3(centerWs, m_dataLs.extents, rotationWs);
}
