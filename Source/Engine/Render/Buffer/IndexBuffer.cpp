///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: February 15th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Render/Buffer/IndexBuffer.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
bool IndexBuffer::CopyToGPU(const uint32* indices, const uint32 indexCount)
{
	// Nothing to copy
	if (indices == nullptr || indexCount == 0)
	{
		return false;
	}

	size_t sizeNeeded = sizeof(uint32) * indexCount;

	bool succeeded = false;
	if (sizeNeeded > GetBufferSize() || IsStatic())
	{
		succeeded = CreateOnGPU(indices, sizeNeeded, sizeof(uint32), RENDER_BUFFER_USAGE_INDEX_STREAM_BIT, GPU_MEMORY_USAGE_DYNAMIC);
	}
	else
	{
		ASSERT_OR_DIE(IsDynamic(), "IndexBuffer not dynamic!");
		succeeded = RenderBuffer::CopyToGPU(indices, sizeNeeded);
	}

	m_indexCount = (succeeded ? indexCount : 0U);

	return succeeded;
}
