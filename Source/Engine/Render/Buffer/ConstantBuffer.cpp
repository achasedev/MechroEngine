///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: December 16th, 2019
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Render/Buffer/ConstantBuffer.h"
#include "Engine/Core/EngineCommon.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
bool ConstantBuffer::CopyToGPU(const void* data, size_t byteSize)
{
	// Create the buffer if not created yet
	if (byteSize > GetBufferSize() || IsStatic())
	{
		bool result = CreateOnGPU(data, byteSize, byteSize, RENDER_BUFFER_USAGE_CONSTANT_BUFFER_BIT, GPU_MEMORY_USAGE_DYNAMIC);
		return result;
	}

	// Sanity check
	ASSERT_OR_DIE(IsDynamic(), "UniformBuffer not dynamic!");

	return RenderBuffer::CopyToGPU(data, byteSize);
}


//-------------------------------------------------------------------------------------------------
// Clones this buffer into the given constant buffer
void ConstantBuffer::CloneInto(ConstantBuffer* dstBuffer) const
{
	ASSERT_RETURN(dstBuffer != nullptr, NO_RETURN_VAL, "Destination buffer was null for clone!");
	dstBuffer->Reset();

	RenderBuffer::CloneInto(dstBuffer);
}


//-------------------------------------------------------------------------------------------------
// Deep copies the constant buffer
ConstantBuffer* ConstantBuffer::CreateClone() const
{
	// ConstantBuffer doesn't have any additional members (for now) so just clone as a RenderBuffer
	ConstantBuffer* clone = new ConstantBuffer();
	RenderBuffer::CloneInto(clone);

	return clone;
}
