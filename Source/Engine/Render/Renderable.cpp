///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: March 15th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Render/Renderable.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
// Constructor from entity id
Renderable::Renderable(EntityID owningEntity)
	: m_owningEntity(owningEntity)
{
}


//-------------------------------------------------------------------------------------------------
void Renderable::SetDrawMatrix(uint32 drawIndex, const Matrix4& drawMatrix)
{
	m_draws.resize(drawIndex + 1);
	m_draws[drawIndex].m_drawMatrix = drawMatrix;
}


//-------------------------------------------------------------------------------------------------
void Renderable::SetDrawMaterial(uint32 drawIndex, Material* material)
{
	m_draws.resize(drawIndex + 1);
	m_draws[drawIndex].m_material = material;
}


//-------------------------------------------------------------------------------------------------
void Renderable::SetDrawMesh(uint32 drawIndex, Mesh* mesh)
{
	m_draws.resize(drawIndex + 1);
	m_draws[drawIndex].m_mesh = mesh;
}


//-------------------------------------------------------------------------------------------------
void Renderable::SetDraw(uint32 drawIndex, const RenderableDraw& draw)
{
	m_draws.resize(drawIndex + 1);
	m_draws[drawIndex] = draw;
}


//-------------------------------------------------------------------------------------------------
void Renderable::AddDraw(Mesh* mesh, Material* material, Matrix4 drawMatrix /*= Matrix44::IDENTITY*/)
{
	RenderableDraw rendDraw;
	rendDraw.m_mesh = mesh;
	rendDraw.m_material = material;
	rendDraw.m_drawMatrix = drawMatrix;

	m_draws.push_back(rendDraw);
}


//-------------------------------------------------------------------------------------------------
RenderableDraw Renderable::GetDraw(uint32 drawIndex) const
{
	if (drawIndex < GetNumDrawCalls())
	{
		return m_draws[drawIndex];
	}

	return RenderableDraw();
}


//-------------------------------------------------------------------------------------------------
// Checks if the renderable's data is valid enough to be drawn
bool Renderable::IsReadyForDrawing() const
{
	if (m_draws.size() == 0)
		return false;

	for (RenderableDraw draw : m_draws)
	{
		if (draw.m_mesh == nullptr)
		{
			return false;
		}
	}

	return true;
}
