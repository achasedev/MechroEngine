///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: April 24th, 2021
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Core/EngineCommon.h"
#include "Engine/Physics/Particle/Particle.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------


//-------------------------------------------------------------------------------------------------
Particle::Particle(const Vector3& position, const Vector3& velocity, float inverseMass /*= 1.f*/, float damping /*= 0.999f*/, const Vector3& acceleration /*= Vector3::ZERO*/)
	: m_position(position)
	, m_velocity(velocity)
	, m_damping(damping)
	, m_acceleration(acceleration)
{
	SetInverseMass(inverseMass);
}


//-------------------------------------------------------------------------------------------------
void Particle::Integrate(float deltaSeconds)
{
	// Don't move static things
	if (m_iMass == 0.f)
		return;

	// Update position
	m_position += m_velocity * deltaSeconds;

	// Update velocity
	m_velocity += (m_acceleration + m_netForce * m_iMass) * deltaSeconds;

	// Dampen it
	m_velocity *= pow(m_damping, deltaSeconds);

	ClearNetForce();
}


//-------------------------------------------------------------------------------------------------
void Particle::SetMass(float newMass)
{
	ASSERT_RETURN(newMass > 0.f, NO_RETURN_VAL, "Invalid mass!");
	m_iMass = (1.f / newMass);
}


//-------------------------------------------------------------------------------------------------
void Particle::SetInverseMass(float newIMass)
{
	m_iMass = newIMass;
}
