///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: April 17th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------
#pragma once

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Framework/EngineCommon.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------
class AABB2;
class Image;
class Texture2D;

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
class SpritePacker
{
public:
	//-----Public Methods-----

	~SpritePacker();

	void		Initialize(Texture2D* texture);
	void		Initialize(uint32 texelWidth, uint32 texelHeigth);

	bool		PackSprite(const uint8* src, int spriteWidth, int spriteHeight, int srcComponentCount, AABB2& out_uvs);
	void		UpdateTexture();

	Texture2D*	GetTexture();


private:
	//-----Private Methods-----

	void		MoveHeadToNextLine();
	void		BlitSpriteToImage(const uint8* src, int spriteWidth, int spriteHeight, int srcComponentCount);
	AABB2		CalculateUVsForSprite(int spriteWidth, int spriteHeight);


private:
	//-----Private Data-----

	IntVector2						m_writePosition = IntVector2::ZERO;
	int								m_maxHeightThisLine = 0;
	bool							m_imageDirty = true;

	Image*							m_image = nullptr;
	Texture2D*						m_texture = nullptr;
};


///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------
