///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: April 4th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------
#pragma once

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Event/EventSystem.h"
#include "Engine/Framework/EngineCommon.h"
#include "Engine/UI/Canvas.h"
#include "Engine/UI/UIElement.h"
#include "Engine/Utility/NamedProperties.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
Canvas::Canvas()
	: UIElement(nullptr)
{
	m_transform.SetAnchors(AnchorPreset::BOTTOM_LEFT);
	m_transform.SetPosition(Vector2::ZERO);

	g_eventSystem->SubscribeEventCallbackObjectMethod("window-resize", &Canvas::UpdateBounds, *this);
}

//-------------------------------------------------------------------------------------------------
Canvas::~Canvas()
{
	g_eventSystem->UnsubscribeEventCallbackObjectMethod("window-resize", &Canvas::UpdateBounds, *this);
}


//-------------------------------------------------------------------------------------------------
void Canvas::Render() const
{
	UIElement::Render();
}


//-------------------------------------------------------------------------------------------------
void Canvas::SetBounds(float height, float aspect)
{
	m_transform.SetDimensions(height * aspect, height);
}


//-------------------------------------------------------------------------------------------------
bool Canvas::UpdateBounds(NamedProperties& args)
{
	AABB2 currentBounds = AABB2(m_transform.GetWidth(), m_transform.GetHeight());
	AABB2 newBounds = args.Get("client-bounds", currentBounds);

	// Client bounds most likely doesn't start at 0,0 but Canvas space does
	m_transform.SetDimensions(newBounds.GetDimensions());
	return false;
}
