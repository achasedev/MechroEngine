///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: April 20th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Core/EngineCommon.h"
#include "Engine/Job/EngineJobs.h"
#define STB_IMAGE_WRITE_IMPLEMENTATION
#include "ThirdParty/stb/stb_image_write.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
SaveTextureJob::SaveTextureJob(int texelWidth, int texelHeight, int numComponentsPerTexel, const char* filepath, void* data)
	: Job(true) // Auto finalizes
	, m_texelWidth(texelWidth)
	, m_texelHeight(texelHeight)
	, m_numComponentsPerTexel(numComponentsPerTexel)
	, m_destFilepath(filepath)
	, m_data(data)
{
}


//-------------------------------------------------------------------------------------------------
void SaveTextureJob::Execute()
{
	ASSERT_RETURN(m_data != nullptr, NO_RETURN_VAL, "Save texture job received null data!");
	stbi_write_png(m_destFilepath.c_str(), m_texelWidth, m_texelHeight, m_numComponentsPerTexel, m_data, 0);

	// Free the buffer
	SAFE_FREE(m_data);
}


//-------------------------------------------------------------------------------------------------
void SaveTextureJob::Finalize()
{
	// Nothing 
	int x = 0;
	x = 5;
}
