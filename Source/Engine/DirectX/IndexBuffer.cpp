///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: February 15th, 2020
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                             *** INCLUDES ***
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/DirectX/IndexBuffer.h"

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                             *** DEFINES ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                              *** TYPES ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                             *** STRUCTS ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                        *** GLOBALS AND STATICS ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                           *** C FUNCTIONS ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
///                                                             *** CLASSES ***
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
bool IndexBuffer::CopyToGPU(const uint* indices, const uint indexCount)
{
	// Nothing to copy
	if (indices == nullptr || indexCount == 0)
	{
		// TODO: Put a warning here
		return false;
	}

	size_t sizeNeeded = sizeof(uint) * indexCount;

	bool succeeded = false;
	if (sizeNeeded > GetBufferSize() || IsStatic())
	{
		succeeded = CreateOnGPU(indices, sizeNeeded, sizeof(uint), RENDER_BUFFER_USAGE_INDEX_STREAM_BIT, GPU_MEMORY_USAGE_DYNAMIC);
	}
	else
	{
		ASSERT_OR_DIE(IsDynamic(), "IndexBuffer not dynamic!");
		succeeded = RenderBuffer::CopyToGPU(indices, sizeNeeded);
	}

	m_indexCount = (succeeded ? indexCount : 0U);

	return succeeded;
}
