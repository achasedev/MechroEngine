///--------------------------------------------------------------------------------------------------------------------------------------------------
/// Author: Andrew Chase
/// Date Created: Nov 16th, 2021
/// Description: 
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// INCLUDES
///--------------------------------------------------------------------------------------------------------------------------------------------------
#include "Engine/Core/EngineCommon.h"
#include "Engine/Math/MathUtils.h"
#include "Engine/Math/Matrix3.h"
#include "Engine/Math/Triangle2.h"
#include "Engine/Math/Triangle3.h"


///--------------------------------------------------------------------------------------------------------------------------------------------------
/// DEFINES
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// ENUMS, TYPEDEFS, STRUCTS, FORWARD DECLARATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// GLOBALS AND STATICS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// C FUNCTIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

///--------------------------------------------------------------------------------------------------------------------------------------------------
/// CLASS IMPLEMENTATIONS
///--------------------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------
void Triangle3::TransformSelfInto2DBasis(Triangle2& out_triangle2) const
{
	Matrix3 basis;
	GetBasis(basis);
	basis.Invert();

	// Choose a to be origin, b - a is i vector
	out_triangle2.m_a = Vector2::ZERO;
	out_triangle2.m_b = (basis * (m_b - m_a)).xy;
	out_triangle2.m_c = (basis * (m_c - m_a)).xy;
}


//-------------------------------------------------------------------------------------------------
Vector2 Triangle3::TransformPointInto2DBasis(const Vector3& point) const
{
	Matrix3 basis;
	GetBasis(basis);
	basis.Invert();

	return (basis * (point - m_a)).xy;
}


//-------------------------------------------------------------------------------------------------
Vector3 Triangle3::TransformPointOutOf2DBasis(const Vector2& point) const
{
	Matrix3 basisVectors;
	GetBasis(basisVectors);

	return basisVectors.iBasis * point.x + basisVectors.jBasis * point.y + m_a;
}


//-------------------------------------------------------------------------------------------------
void Triangle3::GetBasis(Matrix3& out_bases) const
{
	Vector3 i = (m_b - m_a).GetNormalized();
	Vector3 inPlaneRef = (m_c - m_a); // Keep things ortho
	Vector3 k = CrossProduct(i, inPlaneRef).GetNormalized();
	Vector3 j = CrossProduct(k, i);

	out_bases = Matrix3(i, j, k);
}
